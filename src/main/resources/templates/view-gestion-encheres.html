<!DOCTYPE html>
<html lang="fr"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <title>Enchères</title>
    <link rel="icon" href="/images/logo.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/darkly/bootstrap.min.css" rel="stylesheet">
</head>

<body>

<header th:replace="~{fragments/entete :: frag-entete}"></header>

<main class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-md-11">

            <div class="border rounded p-4 shadow">

                <h1 class="text-warning text-center mb-4">Liste des enchères</h1>

                <form th:action="@{/gestionEncheresFiltrees}"
                      method="get"
                      th:object="${articleVenduDto}">

                    <div class="d-flex justify-content-center flex-wrap mb-4">

                        <div class="col-md-4 m-3">
                            <label for="lettreRecherche" class="form-label">Filtres</label>
                            <input type="text"
                                   id="lettreRecherche"
                                   name="lettreRecherche"
                                   class="form-control">
                        </div>

                        <div class="col-md-4 m-3">
                            <label for="noCategorie" class="form-label">Catégorie</label>
                            <select id="noCategorie"
                                    th:field="*{noCategorie}"
                                    class="form-select">
                                <option th:each="categorie : ${@categorieServiceImpl.findAllCategorie()}"
                                        th:value="${categorie.noCategorie}"
                                        th:text="${categorie.libelle}">
                                </option>
                            </select>
                        </div>

                    </div>

                    <div class="row justify-content-center mb-4">

                        <div class="col-md-4">
                            <div class="form-check mb-2">
                                <input class="form-check-input"
                                       type="radio"
                                       id="radioAchats"
                                       th:name="typeRecherche"
                                       value="achats"
                                       th:checked="${radioMemorise == 'achats'}">
                                <label class="form-check-label" for="radioAchats">
                                    Achats
                                </label>
                            </div>

                            <div id="groupeAchats" class="ms-3">
                                <div class="form-check">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           name="groupeAchats"
                                           value="encheresOuvertes"
                                           id="encheresOuvertes">
                                    <label class="form-check-label" for="encheresOuvertes">
                                        Enchères ouvertes
                                    </label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           name="groupeAchats"
                                           value="encheresAVenir"
                                           id="encheresAVenir">
                                    <label class="form-check-label" for="encheresAVenir">
                                        Enchères à venir
                                    </label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           name="groupeAchats"
                                           value="mesEncheres"
                                           id="mesEncheres">
                                    <label class="form-check-label" for="mesEncheres">
                                        Mes enchères en cours
                                    </label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           name="groupeAchats"
                                           value="encheresRemportees"
                                           id="encheresRemportees">
                                    <label class="form-check-label" for="encheresRemportees">
                                        Mes enchères remportées
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="form-check mb-2">
                                <input class="form-check-input"
                                       type="radio"
                                       id="radioVentes"
                                       th:name="typeRecherche"
                                       value="ventes"
                                       th:checked="${radioMemorise == 'ventes'}">
                                <label class="form-check-label" for="radioVentes">
                                    Mes ventes
                                </label>
                            </div>

                            <div id="groupeVentes" class="ms-3">
                                <div class="form-check">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           name="groupeVentes"
                                           value="enCours"
                                           id="mesVentesEnCours">
                                    <label class="form-check-label" for="mesVentesEnCours">
                                        Mes ventes en cours
                                    </label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           name="groupeVentes"
                                           value="nonDebutees"
                                           id="mesVentesNonDebutes">
                                    <label class="form-check-label" for="mesVentesNonDebutes">
                                        Ventes non débutées
                                    </label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           name="groupeVentes"
                                           value="terminees"
                                           id="mesVentesTerminees">
                                    <label class="form-check-label" for="mesVentesTerminees">
                                        Ventes terminées
                                    </label>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="text-center mb-4">
                        <button type="submit" class="btn btn-primary px-4">
                            Rechercher
                        </button>
                    </div>

                </form>

                <div class="d-flex flex-wrap justify-content-center">

                    <div class="card m-3"
                         style="width: 18rem;"
                         th:each="article : ${listeArticleVendu}">
                        <div class="card-body text-center">

                            <h3 class="card-title mb-2" th:text="${article.nomArticle}"></h3>

                            <p class="card-text mb-1 text-white">
                                Mise à prix : <span th:text="${article.miseAPrix + ' ' + 'crédits'}" class="card-text mb-1 ms-2 text-warning"></span>
                            </p>


                            <p class="card-text mb-1 text-white">
                                Fin de l'enchère : <br>

                                <span th:text="${#temporals.format(article.dateFinEnchere, 'dd/MM/yyyy') + ' - ' + #temporals.format(article.dateFinEnchere, 'HH:mm')}" class="card-text mb-1 text-warning"></span>

                            </p>

                            <p class="card-text mb-2 text-white">
                                Vendeur :
                                <span th:text="${' ' + article.vendeur}"
                                      sec:authorize="isAnonymous()"
                                      class="card-text mb-1 ms-2 text-warning">

                                </span>
                                <a th:href="@{/profilVendeur/{pseudo}(pseudo=${article.vendeur})}"
                                   th:text="${article.vendeur}"
                                   class="text-warning mb-1 ms-2 link-underline-warning link-underline-opacity-75"
                                   sec:authorize="isAuthenticated()"></a>
                            </p>

                            <a th:href="@{/detail-vente/{id}(id=${article.noArticle})}"
                               class="btn btn-primary"
                               sec:authorize="isAuthenticated()">Détail Vente</a>


                            <a th:if="${#authentication.name == article.vendeur.pseudo and article.dateDebutEnchere.isAfter(#temporals.createNow())}"
                                    th:href="@{/modifier/{id}(id=${article.noArticle})}"
                               class="btn btn-outline-light "
                               sec:authorize="isAuthenticated()">Modifier</a>

                        </div>
                    </div>

                </div>

            </div>

        </div>
    </div>
</main>

<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function () {
        const radioAchats = document.getElementById('radioAchats');
        const radioVentes = document.getElementById('radioVentes');
        const inputsAchats = document.querySelectorAll('#groupeAchats input');
        const inputsVentes = document.querySelectorAll('#groupeVentes input');

        function toggleFiltres() {
            const isAchats = radioAchats.checked;
            inputsAchats.forEach(i => i.disabled = !isAchats);
            inputsVentes.forEach(i => i.disabled = isAchats);
        }

        radioAchats.addEventListener('change', toggleFiltres);
        radioVentes.addEventListener('change', toggleFiltres);
        toggleFiltres();
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
